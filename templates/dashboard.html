{% extends 'base.html' %}
{% block content %}

            <div class="container-xxl flex-grow-1 container-p-y">
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">

              <h4 class="py-3 mb-4"><span class="text-muted fw-light"> Production Line /</span> Dashboard</h4>
                  <div class="d-flex align-content-center flex-wrap gap-3">
                    <div class="d-flex gap-3">
{#                      <button class="btn btn-label-secondary waves-effect">Discard</button>#}
{#                      <button class="btn btn-label-primary waves-effect">Save draft</button>#}
                    </div>
                      {% if not start %}
<div id="startProductionBtn" >
    {% csrf_token %}

<button onclick="startProduction()" class="btn btn-primary waves-effect waves-light">
    <i class="fas fa-play-circle"></i> &nbsp; Start Production
</button>
</div>
<div id="loadingBtn" style="display: none;">
<button class="btn btn-primary waves-effect waves-light" type="button"  disabled>
    <span class="spinner-border me-1" role="status" aria-hidden="true"></span>
    Loading...
</button>
           </div>
                          {% else %}
                          <div id="startProductionBtn" >


<button onclick="startProduction()" class="btn btn-primary waves-effect waves-light">
    <i class="fas fa-play-circle"></i> &nbsp; Ask For New Registration
</button>
</div>
<div id="loadingBtn" style="display: none;">
<button class="btn btn-primary waves-effect waves-light" type="button"  disabled>
    <span class="spinner-border me-1" role="status" aria-hidden="true"></span>
    Loading...
</button>
           </div>
                      {% endif %}

                  </div>
                </div>
                
                <div id="showData" style="{% if not start %}display: none;        {% endif %}">
              <!-- Card Border Shadow -->
                    <div class="card bg-transparent shadow-none my-4 border-0">
                <div class="card-body row p-0 pb-3">
                  <div class="col-12 col-md-8 card-separator">
                    <h3>Welcome back, üëãüèª</h3>
                    <div class="col-12 col-lg-7">
                      <p>Your progress this week is Awesome. let's keep it up and get a lot of points reward !</p>
                    </div>

                  </div>
                  <div class="col-12 col-md-4 ps-md-3 ps-lg-4 pt-3 pt-md-0">
                    <div class="d-flex justify-content-between align-items-center" style="position: relative;">
                      <div>
                        <div>
                          <h5 class="mb-2">Time Spendings</h5>
                          <p class="mb-5">Day report</p>
                        </div>
                        <div class="time-spending-chart">
{#                            <p id="timePassed"></p>#}
                          <h3 class="mb-2" id="timePassed"></h3>
{#                          <span class="badge bg-label-success">+18.4%</span>#}
                        </div>
                      </div>
                      <div id="leadsReportChart" style="min-height: 139.8px;"><div id="apexchartszojv62syi" class="apexcharts-canvas apexchartszojv62syi apexcharts-theme-light" style="width: 130px; height: 139.8px;"><svg id="SvgjsSvg1800" width="130" height="139.8" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.dev" class="apexcharts-svg" xmlns:data="ApexChartsNS" transform="translate(0, 0)" style="background: transparent;"><g id="SvgjsG1802" class="apexcharts-inner apexcharts-graphical" transform="translate(-0.5, 0)"><defs id="SvgjsDefs1801"><clipPath id="gridRectMaskzojv62syi"><rect id="SvgjsRect1804" width="137" height="155" x="-2" y="0" rx="0" ry="0" opacity="1" stroke-width="0" stroke="none" stroke-dasharray="0" fill="#fff"></rect></clipPath><clipPath id="forecastMaskzojv62syi"></clipPath><clipPath id="nonForecastMaskzojv62syi"></clipPath><clipPath id="gridRectMarkerMaskzojv62syi"><rect id="SvgjsRect1805" width="137" height="159" x="-2" y="-2" rx="0" ry="0" opacity="1" stroke-width="0" stroke="none" stroke-dasharray="0" fill="#fff"></rect></clipPath></defs><g id="SvgjsG1806" class="apexcharts-pie"><g id="SvgjsG1807" transform="translate(0, 0) scale(1)"><circle id="SvgjsCircle1808" r="45.658536585365866" cx="66.5" cy="66.5" fill="transparent"></circle><g id="SvgjsG1809" class="apexcharts-slices"><g id="SvgjsG1810" class="apexcharts-series apexcharts-pie-series" seriesName="36h" rel="1" data:realIndex="0"><path id="SvgjsPath1811" d="M 66.5 5.621951219512184 A 60.878048780487816 60.878048780487816 0 0 1 117.38951211290043 33.087511612715616 L 104.66713408467533 41.44063370953671 A 45.658536585365866 45.658536585365866 0 0 0 66.5 20.841463414634134 L 66.5 5.621951219512184 z" fill="rgba(34,169,94,1)" fill-opacity="1" stroke-opacity="1" stroke-linecap="butt" stroke-width="0" stroke-dasharray="0" class="apexcharts-pie-area apexcharts-donut-slice-0" index="0" j="0" data:angle="56.71232876712329" data:startAngle="0" data:strokeWidth="0" data:value="23" data:pathOrig="M 66.5 5.621951219512184 A 60.878048780487816 60.878048780487816 0 0 1 117.38951211290043 33.087511612715616 L 104.66713408467533 41.44063370953671 A 45.658536585365866 45.658536585365866 0 0 0 66.5 20.841463414634134 L 66.5 5.621951219512184 z"></path></g><g id="SvgjsG1812" class="apexcharts-series apexcharts-pie-series" seriesName="56h" rel="2" data:realIndex="1"><path id="SvgjsPath1813" d="M 117.38951211290043 33.087511612715616 A 60.878048780487816 60.878048780487816 0 0 1 103.12569906852212 115.12812962742359 L 93.9692743013916 102.97109722056769 A 45.658536585365866 45.658536585365866 0 0 0 104.66713408467533 41.44063370953671 L 117.38951211290043 33.087511612715616 z" fill="rgba(36,179,100,1)" fill-opacity="1" stroke-opacity="1" stroke-linecap="butt" stroke-width="0" stroke-dasharray="0" class="apexcharts-pie-area apexcharts-donut-slice-1" index="0" j="1" data:angle="86.30136986301369" data:startAngle="56.71232876712329" data:strokeWidth="0" data:value="35" data:pathOrig="M 117.38951211290043 33.087511612715616 A 60.878048780487816 60.878048780487816 0 0 1 103.12569906852212 115.12812962742359 L 93.9692743013916 102.97109722056769 A 45.658536585365866 45.658536585365866 0 0 0 104.66713408467533 41.44063370953671 L 117.38951211290043 33.087511612715616 z"></path></g><g id="SvgjsG1814" class="apexcharts-series apexcharts-pie-series" seriesName="16h" rel="3" data:realIndex="2"><path id="SvgjsPath1815" d="M 103.12569906852212 115.12812962742359 A 60.878048780487816 60.878048780487816 0 0 1 79.49873670579831 125.9741092188255 L 76.24905252934873 111.10558191411914 A 45.658536585365866 45.658536585365866 0 0 0 93.9692743013916 102.97109722056769 L 103.12569906852212 115.12812962742359 z" fill="rgba(40,199,111,1)" fill-opacity="1" stroke-opacity="1" stroke-linecap="butt" stroke-width="0" stroke-dasharray="0" class="apexcharts-pie-area apexcharts-donut-slice-2" index="0" j="2" data:angle="24.657534246575352" data:startAngle="143.013698630137" data:strokeWidth="0" data:value="10" data:pathOrig="M 103.12569906852212 115.12812962742359 A 60.878048780487816 60.878048780487816 0 0 1 79.49873670579831 125.9741092188255 L 76.24905252934873 111.10558191411914 A 45.658536585365866 45.658536585365866 0 0 0 93.9692743013916 102.97109722056769 L 103.12569906852212 115.12812962742359 z"></path></g><g id="SvgjsG1816" class="apexcharts-series apexcharts-pie-series" seriesName="32h" rel="4" data:realIndex="3"><path id="SvgjsPath1817" d="M 79.49873670579831 125.9741092188255 A 60.878048780487816 60.878048780487816 0 0 1 29.87430093147789 115.12812962742359 L 39.03072569860842 102.9710972205677 A 45.658536585365866 45.658536585365866 0 0 0 76.24905252934873 111.10558191411914 L 79.49873670579831 125.9741092188255 z" fill="rgba(83,210,140,1)" fill-opacity="1" stroke-opacity="1" stroke-linecap="butt" stroke-width="0" stroke-dasharray="0" class="apexcharts-pie-area apexcharts-donut-slice-3" index="0" j="3" data:angle="49.315068493150676" data:startAngle="167.67123287671234" data:strokeWidth="0" data:value="20" data:pathOrig="M 79.49873670579831 125.9741092188255 A 60.878048780487816 60.878048780487816 0 0 1 29.87430093147789 115.12812962742359 L 39.03072569860842 102.9710972205677 A 45.658536585365866 45.658536585365866 0 0 0 76.24905252934873 111.10558191411914 L 79.49873670579831 125.9741092188255 z"></path></g><g id="SvgjsG1818" class="apexcharts-series apexcharts-pie-series" seriesName="56h" rel="5" data:realIndex="4"><path id="SvgjsPath1819" d="M 29.87430093147789 115.12812962742359 A 60.878048780487816 60.878048780487816 0 0 1 15.61048788709956 33.08751161271562 L 28.332865915324668 41.44063370953671 A 45.658536585365866 45.658536585365866 0 0 0 39.03072569860842 102.9710972205677 L 29.87430093147789 115.12812962742359 z" fill="rgba(126,221,169,1)" fill-opacity="1" stroke-opacity="1" stroke-linecap="butt" stroke-width="0" stroke-dasharray="0" class="apexcharts-pie-area apexcharts-donut-slice-4" index="0" j="4" data:angle="86.30136986301372" data:startAngle="216.986301369863" data:strokeWidth="0" data:value="35" data:pathOrig="M 29.87430093147789 115.12812962742359 A 60.878048780487816 60.878048780487816 0 0 1 15.61048788709956 33.08751161271562 L 28.332865915324668 41.44063370953671 A 45.658536585365866 45.658536585365866 0 0 0 39.03072569860842 102.9710972205677 L 29.87430093147789 115.12812962742359 z"></path></g><g id="SvgjsG1820" class="apexcharts-series apexcharts-pie-series" seriesName="16h" rel="6" data:realIndex="5"><path id="SvgjsPath1821" d="M 15.61048788709956 33.08751161271562 A 60.878048780487816 60.878048780487816 0 0 1 66.48937477611985 5.621952146737883 L 66.49203108208988 20.84146411005341 A 45.658536585365866 45.658536585365866 0 0 0 28.332865915324668 41.44063370953671 L 15.61048788709956 33.08751161271562 z" fill="rgba(169,233,197,1)" fill-opacity="1" stroke-opacity="1" stroke-linecap="butt" stroke-width="0" stroke-dasharray="0" class="apexcharts-pie-area apexcharts-donut-slice-5" index="0" j="5" data:angle="56.71232876712327" data:startAngle="303.28767123287673" data:strokeWidth="0" data:value="23" data:pathOrig="M 15.61048788709956 33.08751161271562 A 60.878048780487816 60.878048780487816 0 0 1 66.48937477611985 5.621952146737883 L 66.49203108208988 20.84146411005341 A 45.658536585365866 45.658536585365866 0 0 0 28.332865915324668 41.44063370953671 L 15.61048788709956 33.08751161271562 z"></path></g></g></g><g id="SvgjsG1822" class="apexcharts-datalabels-group" transform="translate(0, 0) scale(1)"><text id="SvgjsText1823" font-family="Helvetica, Arial, sans-serif" x="66.5" y="86.5" text-anchor="middle" dominant-baseline="auto" font-size=".7rem" font-weight="400" fill="#a5a3ae" class="apexcharts-text apexcharts-datalabel-label" style="font-family: Helvetica, Arial, sans-serif;">Total</text><text id="SvgjsText1824" font-family="Public Sans" x="66.5" y="67.5" text-anchor="middle" dominant-baseline="auto" font-size="1.5rem" font-weight="500" fill="#5d596c" class="apexcharts-text apexcharts-datalabel-value" style="font-family: &quot;Public Sans&quot;;">231h</text></g></g><line id="SvgjsLine1825" x1="0" y1="0" x2="133" y2="0" stroke="#b6b6b6" stroke-dasharray="0" stroke-width="1" stroke-linecap="butt" class="apexcharts-ycrosshairs"></line><line id="SvgjsLine1826" x1="0" y1="0" x2="133" y2="0" stroke-dasharray="0" stroke-width="0" stroke-linecap="butt" class="apexcharts-ycrosshairs-hidden"></line></g><g id="SvgjsG1803" class="apexcharts-annotations"></g></svg><div class="apexcharts-legend"></div><div class="apexcharts-tooltip apexcharts-theme-false"><div class="apexcharts-tooltip-series-group" style="order: 1;"><span class="apexcharts-tooltip-marker" style="background-color: rgb(34, 169, 94);"></span><div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;"><div class="apexcharts-tooltip-y-group"><span class="apexcharts-tooltip-text-y-label"></span><span class="apexcharts-tooltip-text-y-value"></span></div><div class="apexcharts-tooltip-goals-group"><span class="apexcharts-tooltip-text-goals-label"></span><span class="apexcharts-tooltip-text-goals-value"></span></div><div class="apexcharts-tooltip-z-group"><span class="apexcharts-tooltip-text-z-label"></span><span class="apexcharts-tooltip-text-z-value"></span></div></div></div><div class="apexcharts-tooltip-series-group" style="order: 2;"><span class="apexcharts-tooltip-marker" style="background-color: rgb(36, 179, 100);"></span><div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;"><div class="apexcharts-tooltip-y-group"><span class="apexcharts-tooltip-text-y-label"></span><span class="apexcharts-tooltip-text-y-value"></span></div><div class="apexcharts-tooltip-goals-group"><span class="apexcharts-tooltip-text-goals-label"></span><span class="apexcharts-tooltip-text-goals-value"></span></div><div class="apexcharts-tooltip-z-group"><span class="apexcharts-tooltip-text-z-label"></span><span class="apexcharts-tooltip-text-z-value"></span></div></div></div><div class="apexcharts-tooltip-series-group" style="order: 3;"><span class="apexcharts-tooltip-marker" style="background-color: rgb(40, 199, 111);"></span><div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;"><div class="apexcharts-tooltip-y-group"><span class="apexcharts-tooltip-text-y-label"></span><span class="apexcharts-tooltip-text-y-value"></span></div><div class="apexcharts-tooltip-goals-group"><span class="apexcharts-tooltip-text-goals-label"></span><span class="apexcharts-tooltip-text-goals-value"></span></div><div class="apexcharts-tooltip-z-group"><span class="apexcharts-tooltip-text-z-label"></span><span class="apexcharts-tooltip-text-z-value"></span></div></div></div><div class="apexcharts-tooltip-series-group" style="order: 4;"><span class="apexcharts-tooltip-marker" style="background-color: rgb(83, 210, 140);"></span><div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;"><div class="apexcharts-tooltip-y-group"><span class="apexcharts-tooltip-text-y-label"></span><span class="apexcharts-tooltip-text-y-value"></span></div><div class="apexcharts-tooltip-goals-group"><span class="apexcharts-tooltip-text-goals-label"></span><span class="apexcharts-tooltip-text-goals-value"></span></div><div class="apexcharts-tooltip-z-group"><span class="apexcharts-tooltip-text-z-label"></span><span class="apexcharts-tooltip-text-z-value"></span></div></div></div><div class="apexcharts-tooltip-series-group" style="order: 5;"><span class="apexcharts-tooltip-marker" style="background-color: rgb(126, 221, 169);"></span><div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;"><div class="apexcharts-tooltip-y-group"><span class="apexcharts-tooltip-text-y-label"></span><span class="apexcharts-tooltip-text-y-value"></span></div><div class="apexcharts-tooltip-goals-group"><span class="apexcharts-tooltip-text-goals-label"></span><span class="apexcharts-tooltip-text-goals-value"></span></div><div class="apexcharts-tooltip-z-group"><span class="apexcharts-tooltip-text-z-label"></span><span class="apexcharts-tooltip-text-z-value"></span></div></div></div><div class="apexcharts-tooltip-series-group" style="order: 6;"><span class="apexcharts-tooltip-marker" style="background-color: rgb(169, 233, 197);"></span><div class="apexcharts-tooltip-text" style="font-family: Helvetica, Arial, sans-serif; font-size: 12px;"><div class="apexcharts-tooltip-y-group"><span class="apexcharts-tooltip-text-y-label"></span><span class="apexcharts-tooltip-text-y-value"></span></div><div class="apexcharts-tooltip-goals-group"><span class="apexcharts-tooltip-text-goals-label"></span><span class="apexcharts-tooltip-text-goals-value"></span></div><div class="apexcharts-tooltip-z-group"><span class="apexcharts-tooltip-text-z-label"></span><span class="apexcharts-tooltip-text-z-value"></span></div></div></div></div></div></div>
                    <div class="resize-triggers"><div class="expand-trigger"><div style="width: 342px; height: 171px;"></div></div><div class="contract-trigger"></div></div></div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-4 col-lg-4 mb-4">
                  <div class="card card-border-shadow-primary">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-2 pb-1">
                        <div class="avatar me-2">
                          <span class="avatar-initial rounded bg-label-primary"><i class="ti ti-truck ti-md"></i></span>
                        </div>
                        <h4 class="ms-1 mb-0" id="countNode">{{ node|length }}</h4>
                      </div>
                      <p class="mb-1">Online Node</p>
                      <p class="mb-0">
                        <span class="fw-medium me-1">+18.2%</span>
                        <small class="text-muted">than last week</small>
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-sm-4 col-lg-4 mb-4" style="margin: 0;padding: 0;    ">
{#                   <button#}
{#                                tabindex="0" aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser2"#}
{#                                onclick="singleNodeDataFaultActionAll()"#}
{#                        class="btn btn-outline-warning btn-block  btn-warning"> #}
                    <div class="card card-border-shadow-warning">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-2 pb-1">
                        <div class="avatar me-2">
                          <span class="avatar-initial rounded bg-label-warning"
                            ><i class="ti ti-git-fork ti-md"></i
                          ></span>
                        </div>
                        <h4 id="Faultresult" class="ms-1 mb-0">{{ Faultresult }}</h4>
                      </div>
                      <p class="mb-1">Fault In Production (For Current Run)
                          </p>
                      <p class="mb-0">
                        <small class="text-muted"> Click To Open</small>
                      </p>
                    </div>
                  </div>
{#                    </button>#}
                </div>
                <div class="col-sm-4 col-lg-4 mb-4">
                  <div class="card card-border-shadow-info">
                    <div class="card-body">
                      <div class="d-flex align-items-center mb-2 pb-1">
                        <div class="avatar me-2">
                          <span class="avatar-initial rounded bg-label-info"><i class="ti ti-clock ti-md"></i></span>
                        </div>
                        <h4 id="collectionCount" class="ms-1 mb-0">{{ collectionCount }}</h4>
                      </div>
                      <p class="mb-1">Number Report To Broker (For Current Run)</p>
                      <p class="mb-0">
{#                        <span class="fw-medium me-1">-2.5%</span>#}
{#                        <small class="text-muted">than last week</small>#}
                      </p>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-xl-12">
                  <div class="card h-100">
                    <div class="card-header d-flex align-items-center justify-content-between">
                      <h5 class="card-title m-0 me-2"> Statistics Overview For Last Run</h5>
                      <div class="dropdown">
                        <button
                          class="btn p-0"
                          type="button"
                          id="topic"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false">
                          <i class="ti ti-dots-vertical"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="topic">
                          <a class="dropdown-item" href="javascript:void(0);">Highest Views</a>
                          <a class="dropdown-item" href="javascript:void(0);">See All</a>
                        </div>
                      </div>
                    </div>
                    <div class="card-body row g-3">
                      <div class="col-md-6">
                        <div id="horizontalBarChart"></div>
                      </div>
                      <div class="col-md-6 d-flex justify-content-around align-items-center">
                        <div class="row" id="NodehorizontalBarChart" >
{#                          <div class="d-flex col-6 align-items-baseline">#}
{#                            <span class="text-primary me-2"><i class="ti ti-circle-filled fs-6"></i></span>#}
{#                            <div>#}
{#                              <p class="mb-2">UI Design</p>#}
{#                              <h5>35%</h5>#}
{#                            </div>#}
{#                          </div>#}
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
<div><br></div>
                <div  class="col-lg-6 col-xl-6">

      <div id="connectionsList" class="card card-action mb-4">
        <div class="card-header align-items-center">
          <h5 class="card-action-title mb-0">Connections</h5>

          <div class="card-action-element">
          <div id="startAllNode">
              {% if startallNode %}
            <button onclick="startProductionAllNode('create')"  type="button" class="btn btn-sm btn-label-primary mt-md-3 waves-effect">
                                          Start Over
                                        </button>
            <button type="button" onclick="startProductionAllNode('create')" class="btn btn-sm btn-label-warning mt-md-3 waves-effect">
                                    <div class="spinner-border spinner-border-sm text-secondary" role="status">
                        <span class="visually-hidden">Loading...</span> </div> &nbsp;Running   </button>
                  <button onclick="startProductionAllNode('stop')"  type="button" class="btn btn-sm btn-label-danger mt-md-3 waves-effect">
                                          Stop All Node
                                        </button>
            {% else %}
            <button onclick="startProductionAllNode('create')"  type="button" class="btn btn-sm btn-label-primary mt-md-3 waves-effect">
                                          Start All Node
                                        </button>

            {% endif %}
                            </div>
          </div>
        </div>
        <div class="card-body">

          <ul id="nodeList"  style="height: 400px; overflow-y: auto;" class="list-unstyled mb-0">

                {% for foo in node %}
<li class="mb-3">
        <div class="d-flex align-items-start">
          <div class="d-flex align-items-start">
            <div class="me-2 ms-1">
              <h6 class="mb-0">{{ foo.NodeType.upper }} at {{ foo.ProductLine.upper }}</h6>
              <small class="text-muted">ID: #{{ foo.NodeID.upper }} | Date: {{ foo.updated_at |date:'Y-m-d H:i:s' }}</small>
            </div>
          </div>
          <div class="ms-auto">
              {% if startallNode %}
{#               <button class="btn btn-label-primary btn-icon btn-sm waves-effect">#}
{#              <i class="fa-solid fa-play"></i>#}
{#            </button>#}
{#            <button class="btn btn-label-primary btn-icon btn-sm waves-effect">#}
{#              <i class="fa-solid fa-stop"></i>#}
{#            </button>#}
              {% endif %}

          </div>
        </div>
      </li>

                     {% endfor %}

            <!-- WebSocket data will be dynamically added here -->
          </ul>

        </div>
      </div>
    </div>
              <div  class="col-lg-6 col-xxl-6" >
                  <div class="card h-100">
                    <div class="card-header d-flex align-items-center justify-content-between mb-2">
                      <div class="card-title mb-0">
                        <h5 class="m-0 me-2">Production Log For Current Run</h5>
                        <small class="text-muted">12% increase in this month</small>
                      </div>
                      <div class="dropdown">
                          <div class="btn-group  float-end" role="group" aria-label="Basic radio toggle button group">
                            <input type="radio" class="btn-check" onclick="getcurrentLog('all')" name="btnradio" id="btnradio1" checked="">
                            <label class="btn btn-outline-primary waves-effect" for="btnradio1">All</label>

                            <input type="radio" class="btn-check" name="btnradio" onclick="getcurrentLog('moscow')" id="btnradio2">
                            <label class="btn btn-outline-primary waves-effect" for="btnradio2">Moscow</label>

                            <input type="radio" class="btn-check" name="btnradio" onclick="getcurrentLog('cda')" id="btnradio3">
                            <label class="btn btn-outline-primary waves-effect" for="btnradio3">CDA</label>
                          </div>
                          <button id="" onclick="singleNodeDataFaultActionCurrentRun()" class="btn btn-warning float-end   btn-label-warning mt-md-3 waves-effect" tabindex="0" aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser2">
                          <span><i class="ti ti-hand-click me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">Open Fault</span></span></button>

                      </div>
                    </div>
                    <div class="card-body">
                      <ul class="p-0 m-0"  style="height: 355px; overflow-y: auto;"  id="logAllnode">
                     </ul>
                    </div>
                  </div>
                </div>

              <div><br></div>
                  <div class="col-12 col-xl-12 mb-4">
                  <div class="card">
                    <div class="card-header d-flex justify-content-between">
                      <div class="card-title mb-0">
                        <h5 class="mb-0">Select Node To View Data </h5>
                        <small class="text-muted">Node Overview</small>
                      </div>
                      <div class="dropdown">
                        <button class="btn p-0" type="button" id="earningReportsTabsId" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="ti ti-dots-vertical ti-sm text-muted"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="earningReportsTabsId">
                          <a class="dropdown-item" href="javascript:void(0);">View More</a>
                          <a class="dropdown-item" href="javascript:void(0);">Delete</a>
                        </div>
                      </div>
                    </div>
                    <div class="card-body">
                      <ul id="nodeList2" class="nav nav-tabs widget-nav-tabs pb-3 gap-4 mx-1 d-flex flex-nowrap" role="tablist">
                     {% for foo in node %}

                        <li class="nav-item" role="presentation">
                          <a href="javascript:void(0);" onclick="getNodeView('{{ foo.NodeID }}')" class="nav-link btn {% if foo.NodeID == 'gatesroomba12' %}
                           active
                          {% endif %}

                            d-flex flex-column align-items-center justify-content-center" role="tab" data-bs-toggle="tab" data-bs-target="#navs-orders-id" aria-controls="navs-orders-id" aria-selected="true">
                            <div class="badge bg-label-secondary rounded p-2">
                              <i class="fas fa-robot ti-sm"></i>
                            </div>
                            <h6 class="tab-widget-title mb-0 mt-2" style="font-size: 12px">{{ foo.NodeID.upper }}</h6>
                          </a>
                        </li>

                     {% endfor %}
                      </ul>
                      <div class="tab-content p-0 ms-0 ms-sm-2">

                      </div>
                    </div>
                  </div>
                </div>
{#                     <div class="col-lg-12 col-xl-6">#}
{#                  <div class="card h-100">#}
{#                    <div class="card-header d-flex align-items-center justify-content-between">#}
{#                      <div class="card-title mb-0">#}
{#                        <h5 class="m-0 me-2">Reasons for delivery exceptions</h5>#}
{#                      </div>#}
{#                      <div class="dropdown">#}
{#                        <button#}
{#                          class="btn p-0"#}
{#                          type="button"#}
{#                          id="deliveryExceptions"#}
{#                          data-bs-toggle="dropdown"#}
{#                          aria-haspopup="true"#}
{#                          aria-expanded="false">#}
{#                          <i class="ti ti-dots-vertical"></i>#}
{#                        </button>#}
{#                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="deliveryExceptions">#}
{#                          <a class="dropdown-item" href="javascript:void(0);">Select All</a>#}
{#                          <a class="dropdown-item" href="javascript:void(0);">Refresh</a>#}
{#                          <a class="dropdown-item" href="javascript:void(0);">Share</a>#}
{#                        </div>#}
{#                      </div>#}
{#                    </div>#}
{#                    <div class="card-body">#}
{#                      <div id="deliveryExceptionsChart" class="pt-md-4"></div>#}
{#                    </div>#}
{#                  </div>#}
{#                </div>#}
                  <br>
                <div></div>    </div>
<div><br></div>

              <!--/ Card Border Shadow -->
              <div class="row">

                <!-- Vehicles overview -->
                <div class="col-xxl-6 mb-4 order-5 order-xxl-0" >
                  <div class="card">
                    <div class="card-header">
                      <div class="card-title mb-0">
                        <h5 class="m-0">Overview</h5> <div id="load-1" style="display:none;" >
                      <div class="sk-wave sk-primary">
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div></div>
                      </div>
                      </div>

                    </div>
                    <div class="card-body">
                      <div class="d-none d-lg-flex vehicles-progress-labels mb-4"  id="collectionStartlabels">

     {% for foo in dataaction %}

                        <div class="vehicles-progress-label on-the-way-text" style="width:{{foo.total}}%">{{ foo.action.title}}</div>

                          {% endfor %}

                      </div>
                      <div class="vehicles-overview-progress progress rounded-2 my-4" style="height: 46px" id="collectionStartprogress">
                            {% for foo in dataaction %}
                                <div
                          class="progress-bar fw-medium text-start bg-body text-dark px-3 rounded-0 bg-gray-900"
                          role="progressbar"
                          style="width: {{foo.total}}% "
                          aria-valuenow="{{foo.total}}"
                          aria-valuemin="0"
                          aria-valuemax="100">
                         {{foo.total}} %
                        </div>
                            {% endfor %}

                      </div>
                      <div class="table-responsive" style="height: 365px; overflow-y: auto;">

                        <table class="table card-table">
                          <tbody class="table-border-bottom-0 "  id="tablecollectionStart">
{#                          {% for foo in collectionStart.collectionStart %}#}
{##}
{#                            <tr>#}
{#                              <td class="w-50 ps-0">#}
{#                                <div class="d-flex justify-content-start align-items-center">#}
{#                                  <div class="me-2">#}
{#                                    <i class="ti ti-truck mt-n1"></i>#}
{#                                  </div>#}
{#                                  <h6 class="mb-0 fw-normal">{{ foo.id_str}} </h6>#}
{#                                </div>#}
{#                              </td>#}
{#                              <td class="text-end pe-0 text-nowrap">#}
{#                                <h6 class="mb-0">{{ foo.duration_str }}</h6>#}
{#                              </td>#}
{#                              <td class="text-end pe-0">#}
{#                                <span class="fw-medium">  <button#}
{#                            data-bs-target="#addRoleModal"#}
{#                            data-bs-toggle="modal" onclick="singleNodeDatalabelCall('{{ foo.id_str}}')"#}
{#                            class="btn btn-primary mb-2 text-nowrap add-new-role">#}
{#                           Open Logs#}
{#                          </button></span>#}
{#                              </td>#}
{#                            </tr>#}
{#                          {% endfor %}#}

                          </tbody>
                        </table>
                      </div>
                    </div>
                       <div class="modal fade" id="addRoleModal" tabindex="-1" aria-hidden="true">

                <div class="modal-dialog modal-lg modal-dialog-centered modal-add-new-role">
                  <div class="modal-content p-3 p-md-5">
                    <button
                      type="button"
                      class="btn-close btn-pinned"
                      data-bs-dismiss="modal"
                      aria-label="Close"></button>
                    <div class="modal-body">
                        <div class="card-header">
                      <div class="card-title mb-0">
                        <h5 class="m-0">Overview <div id="load-3" >
                        <div class="sk-wave sk-primary">
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                      </div></h5>
                      </div>
                    </div>

                    <div class="card-body">
                      <div class="d-none d-lg-flex vehicles-progress-labels mb-4" id="singleNodeDatalabelheader">
                      </div>
                      <div class="vehicles-overview-progress progress rounded-2 my-4"  id="singleNodeDatalabelbody" style="height: 46px">

                      </div>
                      <div class="table-responsive">
                        <table class="table card-table">
                          <tbody class="table-border-bottom-0" id="singleNodeDatalabelsub" style=" overflow-y: auto;" >

                          </tbody>
                        </table>
                      </div>
                    </div>
                    </div>
                  </div>
                </div>
              </div>
                  </div>
                </div>

                <!--/ Vehicles overview -->
                <!-- Shipment statistics-->
                <div class="col-xxl-6 mb-4 order-5 order-xxl-0">
                  <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between">
                      <div class="card-title mb-0">
                        <h5 class="m-0 me-2">Node statistics<div id="load-2" style="display: none" >
                       <div class="sk-wave sk-primary">
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                       </div>
                      </div></h5>
                        <small class="text-muted">Total number of report sent to the broker based on actions </small>
                      </div>
                    </div>
                    <div class="card-body" style="height: 365px; overflow-y: auto;" >
                      <div id="shipmentStatisticsChart"></div>
                    </div>
                  </div>
                </div>

                <div class="col-12 mb-4 order-3 order-xxl-1">
                  <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between">
                      <div class="card-title mb-0">
                        <h5 class="m-0 me-2">Node Full Node<div id="load-all" style="display: none" >
                       <div class="sk-wave sk-primary">
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                        <div class="sk-wave-rect"></div>
                       </div>
                      </div></h5>
                        <small class="text-muted">Total number of report sent to the broker based on actions </small>
                      </div>
                           <div class="dropdown">

                               <button id="" onclick="singleNodeDataFaultAction(null)" class="btn btn-warning  btn-label-warning mt-md-3 waves-effect" tabindex="0" aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser2">
                          <span><i class="ti ti-hand-click me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">Open Fault</span></span></button>
                      </div>
                    </div>
                    <div class="card-body" style="height: 365px; overflow-y: auto;" >
                        <table id="datatable1fullreportProductionLine" class="display table dt-responsive nowrap" style="width:100%">
                                         <thead>

                          <th>Action</th>
                          <th>Label</th>
                                         <th>Data</th>

                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>

                    </div>
                  </div>
                </div>
              </div>
                </div>
            </div>

      <div
                  class="offcanvas offcanvas-end"
                  tabindex="-1"
                  id="offcanvasAddUser"
                  aria-labelledby="offcanvasAddUserLabel">
                  <div class="offcanvas-header">
                    <h5 id="offcanvasAddUserLabel" class="offcanvas-title">Report Detail</h5>
                    <button
                      type="button"
                      class="btn-close text-reset"
                      data-bs-dismiss="offcanvas"
                      aria-label="Close"></button>
                  </div>
                  <div id="reportOne"  class="offcanvas-body mx-0 flex-grow-0 pt-0 h-100">
                 </div>
                </div>
    <div
                  class="offcanvas offcanvas-end"
                  tabindex="-1"
                  id="offcanvasAddUser2"
                  aria-labelledby="offcanvasAddUserLabel">
                  <div class="offcanvas-header">
                    <h5 id="offcanvasAddUserLabel" class="offcanvas-title">Report Detail</h5>
                    <button
                      type="button"
                      class="btn-close text-reset"
                      data-bs-dismiss="offcanvas"
                      aria-label="Close"></button>
                  </div>
                  <div id=""  class="offcanvas-body card-body mx-0 flex-grow-0 pt-0 h-100">
                        <table id="datatable1reportProductionLine" class="display table dt-responsive nowrap" style="width:100%">
                                         <thead>

                          <th>Action</th>
                                         <th>Data</th>

                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>

                 </div>
                </div>

{% endblock %}
{% block JsScriptInner %}
    <script>
    var selectedNode = 'gatesroomba12'
    var selectstartCode = ''
      horizontalBar = JSON.parse('{{ horizontalBar |escapejs|safe  }}')
     // Function to convert text to title case
  function toTitleCase(text) {
    return text.replace(/\w\S*/g, function(txt) {
      return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
  }
function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Check if this cookie name is the one we're looking for
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
  let labelColor, headingColor, borderColor;

  if (isDarkStyle) {
    labelColor = config.colors_dark.textMuted;
    headingColor = config.colors_dark.headingColor;
    borderColor = config.colors_dark.borderColor;
  } else {
    labelColor = config.colors.textMuted;
    headingColor = config.colors.headingColor;
    borderColor = config.colors.borderColor;
  }

  document.getElementById('startProductionBtn').addEventListener('click', function(e) {
        e.preventDefault(); // Prevent the default form submission

        // Disable the startProductionBtn and show the loadingBtn
        document.getElementById('startProductionBtn').style.display = 'none';
        document.getElementById('loadingBtn').style.display = 'inline-block';
        const csrftoken = getCookie('csrftoken');
        // Your AJAX request here
        fetch('{% url 'start_production' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);

            // Now you can access properties of data
            if (dataR && typeof dataR === 'object' && 'Code' in dataR) {
                document.getElementById('showData').style.display = 'inline-block';

            document.getElementById('loadingBtn').style.display = 'none';

            }
        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
    });
  function startProduction () {

        // Disable the startProductionBtn and show the loadingBtn
        document.getElementById('startProductionBtn').style.display = 'none';
        document.getElementById('loadingBtn').style.display = 'inline-block';
        const csrftoken = getCookie('csrftoken');
        // Your AJAX request here
        fetch('{% url 'start_production' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);

            // Now you can access properties of data
            if (dataR && typeof dataR === 'object' && 'Code' in dataR) {
                document.getElementById('showData').style.display = 'inline-block';

            document.getElementById('loadingBtn').style.display = 'none';

            }
        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
    }
  function startProductionAllNode (data) {

        // Disable the startProductionBtn and show the loadingBtn
        const csrftoken = getCookie('csrftoken');
        // Your AJAX request here
        fetch('{% url 'start_all_node_production' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                // Any data you want to send
                'status':data
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(typeof dataR);
            if (dataR && typeof dataR === 'object' && 'startCode' in dataR) {
            console.log(">>>>>>>>>>>>>>>>.")
            document.getElementById('startAllNode').innerHTML = `
             <button onclick="startProductionAllNode('create')"  type="button" class="btn btn-sm btn-label-primary mt-md-3 waves-effect">
                                          Start Over
                                        </button>
            <button type="button" onclick="startProductionAllNode('create')" class="btn btn-sm btn-label-warning mt-md-3 waves-effect">
                                    <div class="spinner-border spinner-border-sm text-secondary" role="status">
                        <span class="visually-hidden">Loading...</span> </div> &nbsp;Running   </button>
            <button onclick="startProductionAllNode('stop')"  type="button" class="btn btn-sm btn-label-danger mt-md-3 waves-effect">
                                          Stop All Node
                                        </button>
                        `;

            }
            else {
                 console.log(">>>>>>>>>>>>>>>>.")
            document.getElementById('startAllNode').innerHTML = `<button onclick="startProductionAllNode('create')"  type="button" class="btn btn-sm btn-label-primary mt-md-3 waves-effect">
                                          Start All Node
                                        </button>
                        `;
            }

getNodeView(selectedNode)
        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
    }
  function startProductionNode (data) {

        // Disable the startProductionBtn and show the loadingBtn
        const csrftoken = getCookie('csrftoken');
        // Your AJAX request here
        fetch('{% url 'start_one_node_production' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);

            // Now you can access properties of data

        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
    }

    function horizontalBarChart(horizontalBar) {

        const horizontalBarChartEl = document.querySelector('#horizontalBarChart'),
            horizontalBarChartConfig = {
                chart: {
                    height: 270,
                    type: 'bar',
                    toolbar: {
                        show: false
                    }
                },
                plotOptions: {
                    bar: {
                        horizontal: true,
                        barHeight: '70%',
                        distributed: true,
                        startingShape: 'rounded',
                        borderRadius: 7
                    }
                },
                grid: {
                    strokeDashArray: 10,
                    borderColor: borderColor,
                    xaxis: {
                        lines: {
                            show: true
                        }
                    },
                    yaxis: {
                        lines: {
                            show: false
                        }
                    },
                    padding: {
                        top: -35,
                        bottom: -12
                    }
                },

                colors: [
                    config.colors.primary,
                    config.colors.info,
                    config.colors.success,
                    config.colors.secondary,
                    config.colors.danger,
                    config.colors.warning
                ],
                dataLabels: {
                    enabled: true,
                    style: {
                        colors: ['#fff'],
                        fontWeight: 200,
                        fontSize: '13px',
                        fontFamily: 'Public Sans'
                    },
                    formatter: function (val, opts) {
                        return horizontalBarChartConfig.labels[opts.dataPointIndex];
                    },
                    offsetX: 0,
                    dropShadow: {
                        enabled: false
                    }
                },
                labels: horizontalBar.labels,

                series: [
                    {
                        data: horizontalBar.data
                    }
                ],

                xaxis: {
                    categories: [],
                    axisBorder: {
                        show: false
                    },
                    axisTicks: {
                        show: false
                    },
                    labels: {
                        style: {
                            colors: labelColor,
                            fontSize: '13px'
                        },
                        formatter: function (val) {
                            return `${val}%`;
                        }
                    }
                },
                yaxis: {
                    max: 100,
                    labels: {
                        style: {
                            colors: [labelColor],
                            fontFamily: 'Public Sans',
                            fontSize: '13px'
                        }
                    }
                },
                tooltip: {
                    enabled: true,
                    style: {
                        fontSize: '12px'
                    },
                    onDatasetHover: {
                        highlightDataSeries: false
                    },
                    custom: function ({series, seriesIndex, dataPointIndex, w}) {
                        return '<div class="px-3 py-2">' + '<span>' + series[seriesIndex][dataPointIndex] + '%</span>' + '</div>';
                    }
                },
                legend: {
                    show: false
                }
            };
        if (typeof horizontalBarChartEl !== undefined && horizontalBarChartEl !== null) {
            const horizontalBarChart = new ApexCharts(horizontalBarChartEl, horizontalBarChartConfig);
            horizontalBarChart.render();
            document.getElementById("NodehorizontalBarChart").innerHTML =''
            console.log(horizontalBar.data.length)
            for (var i = 0; i < horizontalBar.data.length; i++) {
                console.log(horizontalBar.data[i]);  // Output each item in the console

                document.getElementById("NodehorizontalBarChart").innerHTML += ` <div class="d-flex col-6 align-items-baseline">
                            <span class="text-primary me-2"><i class="ti ti-circle-filled fs-6"></i></span>
                            <div>
                              <p class="mb-2">${horizontalBar.labels[i]}</p>
                              <h5>${horizontalBar.data[i]}%</h5>
                            </div>
                          </div>
       ` // Output each item in the console
            }

        }
    }

    horizontalBarChart(horizontalBar)
    // Chart Colors
  const chartColors = {
    donut: {
      series1: config.colors.success,
      series2: '#28c76fb3',
      series3: '#28c76f80',
      series4: config.colors_label.success
    },
    line: {
      series1: config.colors.danger,
      series2: '#00000000',
      series4: config.colors.black,
      series3: '#7367f029'
    },
  };

// Get the host of the current window
const host = window.location.host;
const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";

// WebSocket connection
const socket = new WebSocket(`${protocol}//${host}/ws/node/all`);
// Event listener for when the WebSocket connection is established
socket.addEventListener('open', function (event) {
    console.log('WebSocket connection established');

});

  // Function to handle incoming messages
  socket.onmessage = function(event) {


    console.log('WebSocket Message from server:', event.data);
    const data = JSON.parse(event.data);
    console.log(data);
    const nodeList = document.getElementById('nodeList');
    const nodeList2 = document.getElementById('nodeList2');

    // Clear previous list items
    nodeList.innerHTML = '';
    nodeList2.innerHTML = '';
     document.getElementById('countNode').innerHTML = data['count']

    // Loop through data and create list items
  data['data'].forEach(node => {

      const li = document.createElement('li');
      const li2 = document.createElement('li');
        clicked = node.NodeID===selectedNode ? 'active':''
      li.classList.add('mb-3');
      li2.classList.add('mb-3');
      li.innerHTML = `
        <div class="d-flex align-items-start">
          <div class="d-flex align-items-start">
            <div class="me-2 ms-1">
              <h6 class="mb-0">${node.NodeType.toUpperCase()} at ${node.ProductLine.toUpperCase()}</h6>
              <small class="text-muted">ID: #${node.NodeID.toUpperCase()} | Date: ${node.updated_at}</small>
            </div>
          </div>
          <div class="ms-auto">
            <button class="btn btn-label-primary btn-icon btn-sm waves-effect">
              <i class="fa-solid fa-play"></i>
            </button>
            <button class="btn btn-label-primary btn-icon btn-sm waves-effect">
              <i class="fa-solid fa-stop"></i>
            </button>
          </div>
        </div>
      `;
      nodeList.appendChild(li);

     li2.innerHTML = ` <li class="nav-item" role="presentation">
                          <a href="javascript:void(0);" class="nav-link btn s d-flex flex-column align-items-center justify-content-center ${clicked}" role="tab" data-bs-toggle="tab" data-bs-target="#navs-orders-id" aria-controls="navs-orders-id" aria-selected="true">
                            <div class="badge bg-label-secondary rounded p-2">
                              <i class="fas fa-robot ti-sm"></i>
                            </div>
                            <h6 class="tab-widget-title mb-0 mt-2" style="font-size: 12px">${node.NodeID.toUpperCase()}</h6>
                          </a>
                        </li>   `;
      nodeList2.appendChild(li2);
    });

    horizontalBarChart(data.horizontalBarChart)
      if(data.isStart){
          document.getElementById('startAllNode').innerHTML = `
             <button onclick="startProductionAllNode('create')"  type="button" class="btn btn-sm btn-label-primary mt-md-3 waves-effect">
                                          Start Over
                                        </button>
            <button type="button" onclick="startProductionAllNode('create')" class="btn btn-sm btn-label-warning mt-md-3 waves-effect">
                                    <div class="spinner-border spinner-border-sm text-secondary" role="status">
                        <span class="visually-hidden">Loading...</span> </div> &nbsp;Running   </button>
            <button onclick="startProductionAllNode('stop')"  type="button" class="btn btn-sm btn-label-danger mt-md-3 waves-effect">
                                          Stop All Node
                                        </button>
                        `;

            }
            else {
                 console.log(">>>>>>>>>>>>>>>>.")
            document.getElementById('startAllNode').innerHTML = `<button onclick="startProductionAllNode('create')"  type="button" class="btn btn-sm btn-label-primary mt-md-3 waves-effect">
                                          Start All Node
                                        </button>
                        `;
            }

getcurrentLog(selectedLine)
    getNodeView(selectedNode)
    singleNodeDatalabelCall(selectedNode,selectstartCode)
  };

// Sending a message to the server
  function updateTimePassed() {
    // Date and time of the past event
     var pastDate = new Date("{{ log.created_at|date:'Y-m-d H:i:s' }}")
    // Current date and time
    var currentDate = new Date();

    // Calculate the time difference in milliseconds
    var timeDifference = currentDate - pastDate;

    // Convert time difference to seconds, minutes, hours, and days
    var seconds = Math.floor(timeDifference / 1000);
    var minutes = Math.floor(seconds / 60);
    var hours = Math.floor(minutes / 60);
    var days = Math.floor(hours / 24);

    // Display the time passed
    var timePassedString = days + " days, " + hours % 24 + " hours, " + minutes % 60 + " minutes, " + seconds % 60 + " seconds";
    document.getElementById("timePassed").innerHTML =days +'<span class="text-muted">d</span> ' +hours % 24+'<span class="text-muted">h</span> '+minutes % 60+'<span class="text-muted">m</span> '+seconds % 60+'<span class="text-muted">s</span>';

    document.getElementById("SvgjsText1824").innerHTML =days+'d '+hours % 24+'h';


}

// Call updateTimePassed function initially
updateTimePassed();

// Update time passed every second
setInterval(updateTimePassed, 1000);

function isEmptyObject(obj) {
    return Object.keys(obj).length === 0 && obj.constructor === Object;
}

function isArrayEmpty(arr) {
    return Array.isArray(arr) && arr.length === 0;
}

function singleNodeDataCall(data) {
    console.log(data)

        document.getElementById("reportOne").innerHTML = '';
    {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
        const csrftoken = getCookie('csrftoken');
     fetch('{% url 'singlereport_production' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                'id':data,
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);
              var htmlContentheader=` <div class="card-header">
                                      <div class="d-flex align-items-start">
                                          <div class="d-flex align-items-start">
                                              <div class="me-2 ms-1">
                                                  <h5 class="mb-0">
                                                      <a href="javascript:;" class="stretched-link text-body">${dataR.NodeID.toUpperCase()}</a>
                                                  </h5>
                                                  <div class="client-info">
                                                      <span class="fw-medium">Node Type: </span><span class="text-muted">${dataR.NodeType.toUpperCase()}</span>
                                                      <br> <span class="fw-medium">Production Line Type: </span><span class="text-muted">${dataR.ProductLine.toUpperCase()}</span>
                                                      <br> <span class="fw-medium">Label: </span><span class="text-muted">${dataR.Report.label}</span>
                                                  </div>
                                              </div>
                                          </div>
                                          <div class="ms-auto"></div>
                                      </div>
                                        <div class="d-flex align-items-center flex-wrap">
                                          <div class="bg-lighter px-3 py-2 rounded me-auto mb-3">
                                          </div>
                                      </div>
                                      <h6 class="mb-0">Report Date: ${humanizeDate(new Date(dataR.ReportDate))}</h6>
                                      <h6 class="mb-0">System Report Date: <span style="font-size: 10px" class="text-body fw-normal">${dataR.created_at}</span></h6>
                                  </div>
                                  </div>`
              var htmlContent=''
              var Fault=''
                  if (typeof dataR.Report !== 'undefined' && typeof dataR.Report.Fault !== 'undefined' && dataR.Report.Fault !== null && !isEmptyObject(dataR.Report.Fault) && !isArrayEmpty(dataR.Report.Fault)) {

                      Fault=`<div class="alert alert-danger d-flex align-items-center" role="alert">
                        <span class="alert-icon text-danger me-2">
                          <i class="ti ti-ban ti-xs"></i>
                        </span>
                        ${dataR.Report.Fault}
                      </div>`
}

            if(dataR.NodeType==='crx10') {
                htmlContent = `<div class="card-body">
                              <div class="card">
                                  <!-- Your provided HTML content here -->
                                  <!-- I'm adding the provided HTML here -->
                                 ${htmlContentheader}
                                  <div class="card-body">

                              </div>
                              <div><br></div>

                                 ${Fault}
                              <ul class="list-unstyled mb-0">
                                  <li class="d-flex mb-4 pb-1 align-items-center">
                                      <div class="avatar flex-shrink-0 me-3">
                                          <span class="avatar-initial rounded bg-label-primary"><i class="ti ti-arrows-move-horizontal ti-md"></i></span>
                                      </div>
                                      <div class="row w-100 align-items-center">
                                          <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                                              <p class="mb-0 fw-medium">Moving</p>
                                          </div>
                                          <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                                              <div class="badge bg-label-secondary">${dataR.Report.isMoving}</div>
                                          </div>
                                      </div>
                                  </li>
                                  <li class="d-flex mb-4 pb-1 align-items-center">
                                      <div class="avatar flex-shrink-0 me-3">
                                          <span class="avatar-initial rounded bg-label-primary"><i class="ti ti-arrows-move-horizontal ti-md"></i></span>
                                      </div>
                                      <div class="row w-100 align-items-center">
                                          <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                                              <p class="mb-0 fw-medium">Is Conveyor Belt  Moving</p>
                                          </div>
                                          <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                                              <div class="badge bg-label-secondary">${dataR.Report.isBeltmoving}</div>
                                          </div>
                                      </div>
                                  </li>
<li class="d-flex mb-4 pb-1 align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-info"><i class="ti ti-refresh ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">CRX10 Ready</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.CRX10Ready}</div>
                            </div>
                          </div>
                        </li>
                        <li class="d-flex mb-4 pb-1 align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-success"><i class="ti ti-home ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">Conveyor Belt Ready</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.convReady}</div>
                            </div>
                          </div>
                        </li>
                        <li class="d-flex mb-4 pb-1 align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-warning"><i class="ti ti-dice ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">With Dice</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.withDice}</div>
                            </div>
                          </div>
                        </li>
                        <li class="d-flex align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-danger"><i class="ti ti-home-plus ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">Is Home</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.isHome}</div>
                            </div>
                          </div>
                        </li>
                          <br>

                          <li class="d-flex align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-success"><i class="ti ti-home-plus ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">Line Sensor Back Belt</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.lineSensorBackBelt}</div>
                            </div>
                          </div>
                        </li>

                          <br>

                          <li class="d-flex align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-danger"><i class="ti ti-home-plus ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">line Sensor Front Belt</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.lineSensorFrontBelt}</div>
                            </div>
                          </div>
                        </li>
                              </ul>
                          </div>`;
            }
            else if(dataR.NodeType==='roomba'){
                      htmlContent = `<div class="card-body">
                              <div class="card">
                                  <!-- Your provided HTML content here -->
                                  <!-- I'm adding the provided HTML here -->
                                 ${htmlContentheader}
                                  <div class="card-body">

                              </div>
                              <div><br></div>

                                 ${Fault}
                              <ul class="list-unstyled mb-0">
                                  <li class="d-flex mb-4 pb-1 align-items-center">
                                      <div class="avatar flex-shrink-0 me-3">
                                          <span class="avatar-initial rounded bg-label-primary"><i class="ti ti-arrows-move-horizontal ti-md"></i></span>
                                      </div>
                                      <div class="row w-100 align-items-center">
                                          <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                                              <p class="mb-0 fw-medium">Moving</p>
                                          </div>
                                          <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                                              <div class="badge bg-label-secondary">${dataR.isMoving}</div>
                                          </div>
                                      </div>
                                  </li>
<li class="d-flex mb-4 pb-1 align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-info"><i class="ti ti-refresh ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">Ready</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.isReady}</div>
                            </div>
                          </div>
                        </li>
                        <li class="d-flex mb-4 pb-1 align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-success"><i class="ti ti-home ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">Dock</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.isDock}</div>
                            </div>
                          </div>
                        </li>
                        <li class="d-flex mb-4 pb-1 align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-warning"><i class="ti ti-dice ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">With Dice</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.withDice}</div>
                            </div>
                          </div>
                        </li>
                        <li class="d-flex align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-danger"><i class="ti ti-home-plus ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">At Base 1</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.isAtBase1}</div>
                            </div>
                          </div>
                        </li>
                          <br>

                          <li class="d-flex align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-success"><i class="ti ti-home-plus ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">At Base 2</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.isAtBase2}</div>
                            </div>
                          </div>
                        </li>

                          <br>

                          <li class="d-flex align-items-center">
                          <div class="avatar flex-shrink-0 me-3">
                            <span class="avatar-initial rounded bg-label-danger"><i class="ti ti-home-plus ti-md"></i></span>
                          </div>
                          <div class="row w-100 align-items-center">
                            <div class="col-sm-8 col-lg-12 col-xxl-8 mb-1 mb-sm-0 mb-lg-1 mb-xxl-0">
                              <p class="mb-0 fw-medium">At Base 2</p>
                            </div>
                            <div class="col-sm-4 col-lg-12 col-xxl-4 d-flex justify-content-xxl-end">
                              <div class="badge bg-label-secondary">${dataR.Report.isAtBase3}</div>
                            </div>
                          </div>
                        </li>
                              </ul>
                          </div>`;
            }

        document.getElementById("reportOne").innerHTML = htmlContent;

        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
}
function singleNodeDataLabelAction(data,id) {
    console.log(data)
    var dataTable = $('#datatable1reportProductionLine').DataTable();
if (dataTable !== 'undefined') {
    dataTable.destroy();
}

        {#document.getElementById("reportProductionLine").innerHTML = '';#}
    {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
        const csrftoken = getCookie('csrftoken');
     fetch('/BrokerManager/single-report/label/'+selectedNode+'/action', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                'label':data,

                'startCode': id,
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);
            var table = $('#datatable1reportProductionLine').DataTable({
            data: dataR.data, // Provide the fetched data to the DataTable
            columns: [
                { data: 'Report.action',
                render: function(data, type, row) {
                // If the render is for display, convert the label to uppercase
                if (type === 'display') {
                    return data.toUpperCase();
                }
                // Otherwise, return the original data
                return data;
            }},
                 {
            data: 'id',
            render: function(data, type, row) {
                // Render 'action' as a button with the provided attributes and onclick function
                return `<button id="singleNodeData"
                            onclick="singleNodeDataCall('${data}')"
                            class="btn btn-secondary add-new btn-primary waves-effect waves-light"
                            tabindex="0"
                            aria-controls="DataTables_Table_0"
                            type="button"
                            data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasAddUser">
                            <span><i class="ti ti-hand-click me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">View More Data</span></span>
                        </button>`;
            }
        }
            ],

            pageLength: 50,

    order: [] // Disable s
        });

        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
}
function singleNodeDataFaultAction(id) {
    var dataTable = $('#datatable1reportProductionLine').DataTable();
if (dataTable !== 'undefined') {
    dataTable.destroy();
}

        {#document.getElementById("reportProductionLine").innerHTML = '';#}
    {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
        const csrftoken = getCookie('csrftoken');
     fetch('/BrokerManager/single-report/fault/'+selectedNode, {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                'startCode': id,
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);

   createtable ("datatable1reportProductionLine",dataR.data)
        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
}
function singleNodeDataFaultActionAll() {
    var dataTable = $('#datatable1reportProductionLine').DataTable();
if (dataTable !== 'undefined') {
    dataTable.destroy();
}

        {#document.getElementById("reportProductionLine").innerHTML = '';#}
    {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
        const csrftoken = getCookie('csrftoken');
     fetch('{% url 'fullreport_Fault' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);

   createtable ("datatable1reportProductionLine",dataR.data)
        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
}
function singleNodeDataFaultActionCurrentRun() {
    var dataTable = $('#datatable1reportProductionLine').DataTable();
if (dataTable !== 'undefined') {
    dataTable.destroy();
}

        {#document.getElementById("reportProductionLine").innerHTML = '';#}
    {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
        const csrftoken = getCookie('csrftoken');
     fetch('{% url 'fullreport_production_Fault' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({

                "selectedLine" : selectedLine
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);

   createtable ("datatable1reportProductionLine",dataR.data)
        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
}
function createtable(getIdBy,dataR) {

            var table = $('#'+getIdBy).DataTable({
            data: dataR, // Provide the fetched data to the DataTable
            columns: [
                { data: 'Report.action',
                render: function(data, type, row) {
                // If the render is for display, convert the label to uppercase
                if (type === 'display') {
                    return data.toUpperCase();
                }
                // Otherwise, return the original data
                return data;
            }},
                 {
            data: 'id',
            render: function(data, type, row) {
                // Render 'action' as a button with the provided attributes and onclick function
                return `<button id="singleNodeData"
                            onclick="singleNodeDataCall('${data}')"
                            class="btn btn-secondary add-new btn-primary waves-effect waves-light"
                            tabindex="0"
                            aria-controls="DataTables_Table_0"
                            type="button"
                            data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasAddUser">
                            <span><i class="ti ti-hand-click me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">View More Data</span></span>
                        </button>`;
            }
        }
            ],

            pageLength: 50,
            order: [] // Disable s
        });

}
function singleNodeDatalabelCall(data,id) {
        selectedNode=data
        selectstartCode=id

                document.getElementById('load-3').style.display = 'block';
    {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
        const csrftoken = getCookie('csrftoken');
     fetch('/BrokerManager/single-report/label/'+data, {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                'startCode': id,
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {


                document.getElementById('load-3').style.display = 'none';
        document.getElementById("singleNodeDatalabelheader").innerHTML = '';
        document.getElementById("singleNodeDatalabelbody").innerHTML='';
        document.getElementById("singleNodeDatalabelsub").innerHTML='';
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);
            for (var i = 0; i < dataR.action.length; i++) {
    if (dataR.action[i].total > 0) {
        var htmlContent =
            `
                        <div class="vehicles-progress-label on-the-way-text" style="width: ${dataR.action[i].total}%">${dataR.action[i].action}</div>`;

        document.getElementById("singleNodeDatalabelheader").innerHTML += htmlContent;
        var htmlContentbody =
            `<div
                          class="progress-bar fw-medium text-start bg-body text-dark px-3 rounded-0"
                          role="progressbar"
                          style="width: ${dataR.action[i].total}%"
                          aria-valuenow="${dataR.action[i].total}"
                          aria-valuemin="0"
                          aria-valuemax="100">
                        ${dataR.action[i].total}%
                        </div>`;
        document.getElementById("singleNodeDatalabelbody").innerHTML += htmlContentbody;
    }


            }
             for (var i = 0; i < dataR.label.length; i++) {

                           var htmlContentsub =
                 ` <tr>
                              <td class="w-50 ps-0">
                                <div class="d-flex justify-content-start align-items-center">
                                  <div class="me-2">
                                    <i class="ti ti-truck mt-n1"></i>
                                  </div>
                                  <h6 class="mb-0 fw-normal">${dataR.label[i]}</h6>
                                </div>
                              </td>
                              <td class="text-end pe-0">
                                <span class="fw-medium">
                                  <button id = "" onclick="singleNodeDataLabelAction('${dataR.label[i]}','${id}')"  class="btn btn-secondary add-new btn-primary waves-effect waves-light"
                                   tabindex="0" aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser2">
                          <span><i class="ti ti-hand-click me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">View All Action</span></span></button>

                                </span>
                              </td>
                            </tr>`;

        document.getElementById("singleNodeDatalabelsub").innerHTML += htmlContentsub;

            }


        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
}
getNodeView(selectedNode)
function getNodeView(nodeid) {
        console.log(nodeid)
    selectedNode = nodeid
        {#document.getElementById("reportProductionLine").innerHTML = '';#}
      var dataTable2 = $('#datatable1fullreportProductionLine').DataTable();
    if (dataTable2 !== 'undefined') {
        dataTable2.destroy();
    }
                document.getElementById('load-1').style.display = 'block';
                document.getElementById('load-all').style.display = 'block';
                document.getElementById('load-2').style.display = 'block';
        {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
    {#document.getElementById('loadingBtn').style.display = 'inline-block';#}
        const csrftoken = getCookie('csrftoken');
     fetch('/BrokerManager/single-report/'+nodeid, {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                'nodeID ':"data",
                // Any data you want to send
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
               dataTable2 = $('#datatable1fullreportProductionLine').DataTable();
    if (dataTable2 !== 'undefined') {
        dataTable2.destroy();
    }
             dataR = JSON.parse(data);
            console.log(dataR)
                document.getElementById('load-1').style.display = 'none';
                document.getElementById('load-2').style.display = 'none';
                document.getElementById('load-all').style.display = 'none';

                 document.getElementById("collectionStartprogress").innerHTML =''
                 document.getElementById("tablecollectionStart").innerHTML =''
                 document.getElementById("shipmentStatisticsChart").innerHTML =''
             document.getElementById("collectionStartlabels").innerHTML =''
            dataR.collectionStart.collectionStart.forEach(function(element) {
                var status =  element.duration_str ==='RUNNING'? `<div class="spinner-border text-secondary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>`:element.duration_str
                 document.getElementById("tablecollectionStart").innerHTML +=    `
                            <tr>
                              <td class="w-50 ps-0">
                                <div class="d-flex justify-content-start align-items-center">
                                  <div class="me-2">
                                    <i class="ti ti-truck mt-n1"></i>
                                  </div>
                                  <h6 class="mb-0 fw-normal">${ element.id_str} </h6>
                                </div>
                              </td>
                              <td class="text-end pe-0 text-nowrap">
                                <h6 class="mb-0">${ status} </h6>
                              </td>
                              <td class="text-end pe-0">
                                <span class="fw-medium">  <button
                            data-bs-target="#addRoleModal"
                            data-bs-toggle="modal" onclick="singleNodeDatalabelCall('${nodeid}','${element.id}')"
                            class="btn btn-primary mb-2 text-nowrap add-new-role">
                           Open Logs
                          </button></span>
                              </td>
                    <td class="text-end pe-0">
                                <span class="fw-medium">  <button
                                tabindex="0" aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser2"
                                onclick="singleNodeDataFaultAction('${element.id}')"
                            class="btn btn-warning mb-2 text-nowrap add-new-role">
                           Open Fault
                          </button></span>
                              </td>
                            </tr>`
                });
            var newSeriesData = []
            dataR.reportPerDay.forEach(function(element) {
                var typeDataGraph = element.action==='all' ? "column" : "line";
                newSeriesData.push({
                    name: element.action,
                    type: typeDataGraph,
                    data: element.data
                  })
               });
            dataR.dataaction.forEach(function(element) {
              if (element.total > 0) {
                  document.getElementById("collectionStartlabels").innerHTML +=    `
                        <div class="vehicles-progress-label on-the-way-text" style="width: ${element.total}%">${element.action}</div>
                            `

         document.getElementById("collectionStartprogress").innerHTML +=    `<div
                          class="progress-bar fw-medium text-start bg-body text-dark px-3 rounded-0"
                          role="progressbar"
                          style="width: ${element.total}%"
                          aria-valuenow="${element.total}"
                          aria-valuemin="0"
                          aria-valuemax="100">
                        ${element.total}%
                        </div>
                            `
              }
  });

            var table = $('#datatable1fullreportProductionLine').DataTable({
            data: dataR.data, // Provide the fetched data to the DataTable
            columns: [
                { data: 'Report.action',
                render: function(data, type, row) {
                // If the render is for display, convert the label to uppercase
                if (type === 'display') {
                    return data.toUpperCase();
                }
                // Otherwise, return the original data
                return data;
            }},{ data: 'Report.label',
                render: function(data, type, row) {
                // If the render is for display, convert the label to uppercase
                if (type === 'display') {
                    return data.toUpperCase();
                }
                // Otherwise, return the original data
                return data;
            }},
                 {
            data: 'id',
            render: function(data, type, row) {
                // Render 'action' as a button with the provided attributes and onclick function
                return `<button id="singleNodeData"
                            onclick="singleNodeDataCall('${data}')"
                            class="btn btn-secondary add-new btn-primary waves-effect waves-light"
                            tabindex="0"
                            aria-controls="DataTables_Table_0"
                            type="button"
                            data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasAddUser">
                            <span><i class="ti ti-hand-click me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">View More Data</span></span>
                        </button>`;
            }
        }
            ],

    order: [] ,// Disable s
            pageLength: 50
        });

// Define new x-axis categories
    const shipmentEl = document.querySelector('#shipmentStatisticsChart'),
    shipmentConfig = {
      series: newSeriesData,
      chart: {
        height: 270,
        type: 'line',
        stacked: false,
        parentHeightOffset: 0,
        toolbar: {
          show: false
        },
        zoom: {
          enabled: false
        }
      },
      markers: {
        size: 4,
        colors: [config.colors.white],
        strokeColors: chartColors.line.series2,
        hover: {
          size: 6
        },
        borderRadius: 4
      },
      stroke: {
        curve: 'smooth',
        width: [0, 3],
        lineCap: 'round'
      },
      legend: {
        show: true,
        position: 'bottom',
        markers: {
          width: 8,
          height: 8,
          offsetX: -3
        },
        height: 40,
        offsetY: 10,
        itemMargin: {
          horizontal: 10,
          vertical: 0
        },
        fontSize: '15px',
        fontFamily: 'Public Sans',
        fontWeight: 400,
        labels: {
          colors: headingColor,
          useSeriesColors: false
        },
        offsetY: 10
      },
      grid: {
        strokeDashArray: 8
      },
      fill: {
        opacity: [1, 1]
      },
      plotOptions: {
        bar: {
          columnWidth: '30%',
          startingShape: 'rounded',
          endingShape: 'rounded',
          borderRadius: 4
        }
      },
      dataLabels: {
        enabled: false
      },
      xaxis: {
        tickAmount: 10,
        categories:dataR.date,
        labels: {
          style: {
            colors: labelColor,
            fontSize: '13px',
            fontFamily: 'Public Sans',
            fontWeight: 400
          }
        },
        axisBorder: {
          show: false
        },
        axisTicks: {
          show: false
        }
      },
      yaxis: {
        tickAmount: 4,
        labels: {
          style: {
            colors: labelColor,
            fontSize: '13px',
            fontFamily: 'Public Sans',
            fontWeight: 400
          },
          formatter: function (val) {
            return val ;
          }
        }
      },
      responsive: [
        {
          breakpoint: 1400,
          options: {
            chart: {
              height: 270
            },
            xaxis: {
              labels: {
                style: {
                  fontSize: '10px'
                }
              }
            },
            legend: {
              itemMargin: {
                vertical: 0,
                horizontal: 10
              },
              fontSize: '13px',
              offsetY: 12
            }
          }
        },
        {
          breakpoint: 1399,
          options: {
            chart: {
              height: 415
            },
            plotOptions: {
              bar: {
                columnWidth: '50%'
              }
            }
          }
        },
        {
          breakpoint: 982,
          options: {
            plotOptions: {
              bar: {
                columnWidth: '30%'
              }
            }
          }
        },
        {
          breakpoint: 480,
          options: {
            chart: {
              height: 250
            },
            legend: {
              offsetY: 7
            }
          }
        }
      ]
    };
            if (typeof shipmentEl !== undefined && shipmentEl !== null) {
    const shipment = new ApexCharts(shipmentEl, shipmentConfig);
    shipment.render();
  }


        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
}
function humanizeDate(date) {
    const now = new Date();
    const diff = now.getTime() - date.getTime();
    const seconds = Math.floor(diff / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);

    if (days === 0) {
        if (hours === 0) {
            if (minutes === 0) {
                return seconds <= 1 ? "Just now" : `${seconds} seconds ago`;
            } else {
                return minutes === 1 ? "1 minute ago" : `${minutes} minutes, ${seconds} seconds ago`;
            }
        } else {
            return hours === 1 ? "1 hour ago" : `${hours} hours ago`;
        }
    } else if (days === 1) {
        return "Yesterday";
    } else {
        // For older dates, return a standard date format
        return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }
}


// Example usage:
const date = new Date('2024-04-07T12:00:00');
console.log(humanizeDate(date)); // Output: "2 days ago"

getcurrentLog('all')
var selectedLine ="all"
 function getcurrentLog  (line) {
        const csrftoken = getCookie('csrftoken');
        selectedLine=line
        // Your AJAX request here
        fetch('{% url 'fullreport_production' %}', {
            method: 'POST', // HTTP method
            headers: {
                'Content-Type': 'application/json', // Specify content type

                'X-CSRFToken': csrftoken,// Include CSRF token in request headers
            },
            body: JSON.stringify({
                "selectedLine" : line
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Handle the success response from the server
             dataR = JSON.parse(data);
            console.log(dataR);

        document.getElementById("logAllnode").innerHTML=''
              dataR.data.forEach(log => {

        document.getElementById("logAllnode").innerHTML += `          <li class="d-flex mb-4 pb-1">
                          <div class="avatar flex-shrink-0 me-3">
<button id="singleNodeData" onclick="singleNodeDataCall('${log.id}')" class="btn btn-secondary add-new btn-primary waves-effect waves-light" tabindex="0" aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser">

                            <span class="avatar-initial rounded bg-label-primary"><i class="ti ti-refresh"></i></span>
                        </button>
                          </div>
                          <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                            <div class="me-2">
                              <h6 class="mb-0 fw-normal">${log.Report.label}</h6>
                              <small class="text fw-normal d-block">
                                <i class="ti timeline-point mb-1"></i>
                               ${log.NodeType.toUpperCase()} at (${log.NodeID.toUpperCase()})
                              </small>
                            <small class="text-primary fw-normal d-block">
                                <i class="ti timeline-point mb-1"></i>
                               ${humanizeDate(new Date(log.ReportDate))}
                              </small>
                            </div>
                            <div class="user-progress">
                              <h6 class="mb-0 text-primary">${log.Report.action?log.Report.action.toUpperCase():log.Report.action}</h6>
                            </div>
                          </div>
                        </li>

        `;

              })



        })
        .catch(error => {
            // Handle errors
            console.error('Fetch error:', error);
        })
        .finally(() => {
            // Re-enable the startProductionBtn and hide the loadingBtn when request is complete
        });
    }


    </script>
    {% endblock %}
